<script>
    async function initProfile() {
        // 1. Get the ID from YOUR website URL (e.g., surakshaqr.github.io/?id=SQ100)
        const urlParams = new URLSearchParams(window.location.search);
        const qrId = urlParams.get('id'); 
        
        // 2. YOUR Google Script Exec URL
        const scriptUrl = "https://script.google.com/macros/s/AKfycbzi9Mp6nkIZk7XhlhvaA2tPSowAhW8Ai8EBFZHrCGXKyE0kqSrGFZ67eThCBwLkW1AZ/exec"; 

        const display = document.getElementById('mainDisplay');

        if(!qrId) {
            display.innerHTML = '<div class="card full">Error: No ID found in URL. Please scan the QR again.</div>';
            return;
        }

        try {
            // 3. THE FIX: Construct the URL manually to prevent 'undefined'
            // We use encodeURIComponent to make sure special characters don't break the link
            const finalUrl = `${scriptUrl}?id=${encodeURIComponent(qrId)}`;
            
            console.log("Requesting data for ID:", qrId);

            // 4. Fetch the data
            const response = await fetch(finalUrl);
            const text = await response.text(); // First get it as text to debug
            
            // If you are still using the "Testing" script, this will show the message
            // Once you put back the "Master Universal Code", change text to JSON
            display.innerHTML = `<div class="card full">Server Says: ${text}</div>`;

        } catch (err) {
            console.error(err);
            display.innerHTML = '<div class="card full">Connection Error. Please check your internet.</div>';
        }
    }

    initProfile();
</script>
