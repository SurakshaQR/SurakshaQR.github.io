// [LABEL: DATA FETCHING ENGINE]
async function initProfile() {
    const urlParams = new URLSearchParams(window.location.search);
    const qrId = urlParams.get('id');
    
    // !!! PASTE YOUR NEWEST EXEC URL HERE !!!
    const scriptUrl = "https://script.google.com/macros/s/AKfycbzIIiGCEcfWFBU3018MLWsr8L7uQMltauGF5s-8RchZi8K6Zi-aRSRwDCTo6Xzu0zKK/exec"; 

    try {
        const response = await fetch(`${scriptUrl}?id=${qrId}`);
        const data = await response.json();
        const display = document.getElementById('mainDisplay');

        // Check if the script returned an ACTIVE status
        if (data.Status === "Active") {
            display.innerHTML = `
                <div class="card full">
                    <div class="label">Emergency Profile</div>
                    <div class="val">${data.Name}</div>
                    <div class="blood-badge">BLOOD: ${data.Blood_Group}</div>
                </div>
                <a href="tel:${data.Emergency_Phone}" class="btn btn-call">EMERGENCY CALL</a>
            `;
            // Add Social Links if they exist
            renderSocialLinks(data.Social_Links);
        } else {
            // This triggers the "System Ready" screen if the ID isn't 'Active'
            display.innerHTML = `<div class="card full">System Ready - Unlinked Tag</div>`;
        }
    } catch (err) {
        console.error("Connection failed", err);
    }
}
